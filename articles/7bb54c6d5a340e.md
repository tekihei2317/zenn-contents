---
title: "Vue.js + Laravelã§ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã™ã‚‹ãƒ¡ãƒ¢"
emoji: "ğŸ™"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["vue", "laravel"]
published: false
---

## ç’°å¢ƒ

- Nuxt 3.0.0-rc.1
- Laravel 9.9.0

https://github.com/tekihei2317/vue-laravel-pagination

## ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã¨ã¯

ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã¨ã¯ã€ä½•ã‹ã®ä¸€è¦§ã‚’è¡¨ç¤ºã™ã‚‹ã¨ãã«ã€ã‚ã‚‹å€‹æ•°ã”ã¨ã«åŒºåˆ‡ã£ã¦è¤‡æ•°ã®ãƒšãƒ¼ã‚¸ã«è¡¨ç¤ºã™ã‚‹ã“ã¨ã‚’ã„ã„ã¾ã™ã€‚

## SPAã§ã®ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã®ä¾‹

![](https://i.gyazo.com/a2844d5aca8469d5bd10588276ae3106.png)

ã¾ãšã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒšãƒ¼ã‚¸ç•ªå·ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ï¼ˆâ‘ ï¼‰ã€‚

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã¯ã€ä¾‹ãˆã°ãƒšãƒ¼ã‚¸ç•ªå·2ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸå ´åˆã¯ã€`?page=2`ã®ã‚ˆã†ã«ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä»˜ã‘ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚Šã¾ã™ï¼ˆâ‘¡ï¼‰ã€‚

APIã¯ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ã‚‚ã¨ã«ã€è©²å½“ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’OFFSETå¥ã‚„LIMITå¥ã‚’ä½¿ç”¨ã—ã¦DBã‹ã‚‰å–å¾—ã—ã¾ã™ï¼ˆâ‘¢ã€â‘£ï¼‰ã€‚

æœ€å¾Œã«ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ã‚‚ã¨ã«çŠ¶æ…‹ã‚’æ›´æ–°ã—ã¾ã™ï¼ˆâ‘¤ï¼‰ã€‚

## APIã‚’å®Ÿè£…ã™ã‚‹

Laravelã®APIãƒªã‚½ãƒ¼ã‚¹ã‚’ä½¿ã£ã¦å®Ÿè£…ã—ã¦ã¿ã¾ã™ã€‚APIãƒªã‚½ãƒ¼ã‚¹ã«ãƒšãƒ¼ã‚¸ãƒ³ã‚°ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™ã¨ã€ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã«å¿…è¦ãªæƒ…å ±ï¼ˆåˆè¨ˆãƒšãƒ¼ã‚¸æ•°ã‚„ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ç•ªå·ãªã©ï¼‰ã‚’ä»˜ä¸ã—ã¦ãã‚Œã¾ã™ã€‚

ã¾ãšã€ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã§ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ã£ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€`pagenate`ãƒ¡ã‚½ãƒƒãƒ‰ã§ãƒšãƒ¼ã‚¸ãƒ³ã‚°ã—ã¾ã™ã€‚ãã—ã¦ã€ãƒšãƒ¼ã‚¸ãƒ³ã‚°ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’APIãƒªã‚½ãƒ¼ã‚¹ã«æ¸¡ã—ã¦æ•´å½¢ã—ã¾ã™ã€‚

```php:backend/app/Http/Controllers/TaskController.php
class TaskController extends Controller
{
    public function __construct(
        private Task $taskModel
    ) {
    }

    public function index()
    {
        return TaskResource::collection($this->taskModel->with('status')->paginate(10));
    }
}
```

APIãƒªã‚½ãƒ¼ã‚¹ã§ã¯ã€ã‚¿ã‚¹ã‚¯ã®æƒ…å ±ã«åŠ ãˆã¦ã€ã‚¿ã‚¹ã‚¯ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åã‚’ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ã£ã¦å–å¾—ã—ã¦ã„ã¾ã™ã€‚

```php:backend/app/Http/Resources/TaskResource.php
class TaskResource extends JsonResource
{
    public function toArray($request)
    {
        /** @var \App\Models\Task */
        $task = $this->resource;
        assert($task->relationLoaded('status')); // N+1ãŒèµ·ããªã„ã‚ˆã†ã«ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

        return [
            'id' => $task->id,
            'name' => $task->name,
            'description' => $task->description,
            'status' => $task->status->name,
        ];
    }
}
```

APIãƒªã‚½ãƒ¼ã‚¹ã«ãƒšãƒ¼ã‚¸ãƒ³ã‚°ã—ãŸãƒ‡ãƒ¼ã‚¿ï¼ˆãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚¿ãƒ¼ï¼‰ã‚’æ¸¡ã™ã¨ã€APIãƒªã‚½ãƒ¼ã‚¹ã¯ä»¥ä¸‹ã®æƒ…å ±ã‚’ä»˜ä¸ã—ã¾ã™ã€‚

| ã‚­ãƒ¼       | è©³ç´°                                                                                                                   |
| ---------- | ---------------------------------------------------------------------------------------------------------------------- |
| links      | æœ€åˆã®ãƒšãƒ¼ã‚¸ã€æœ€å¾Œã®ãƒšãƒ¼ã‚¸ã€å–å¾—ã—ãŸãƒšãƒ¼ã‚¸ã®å‰å¾Œã®ãƒšãƒ¼ã‚¸ã®URLã€‚                                                        |
| meta       | ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ç•ªå·ã€æœ€å¾Œã®ãƒšãƒ¼ã‚¸ç•ªå·ã€ãƒšãƒ¼ã‚¸ã®æšã®è¦ç´ æ•°ã€åˆè¨ˆä»¶æ•°ãªã©ã€‚                                                 |
| meta.links | ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®ãƒªãƒ³ã‚¯ã®é›†ã¾ã‚Šã€‚æˆ»ã‚‹ãƒ»é€²ã‚€ãƒªãƒ³ã‚¯ã€ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã®å‰å¾Œ3ãƒšãƒ¼ã‚¸ã®ãƒªãƒ³ã‚¯ã€æœ€åˆã¨æœ€å¾Œã‹ã‚‰2ãƒšãƒ¼ã‚¸ãšã¤ã®ãƒªãƒ³ã‚¯ãŒå…¥ã£ã¦ã„ã‚‹ã€‚ |

ä¾‹ãˆã°ã€åˆè¨ˆä»¶æ•°100ä»¶ãƒ»å„ãƒšãƒ¼ã‚¸3ä»¶ãƒ»ãƒšãƒ¼ã‚¸ç•ªå·10ã§APIã‚’å®Ÿè¡Œã—ãŸå ´åˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

:::details ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ä¾‹

```
$ curl 'localhost:8000/api/tasks?page=10' | jq .
{
  "data": [
    {
      "id": 28,
      "name": "todo28",
      "description": "28å€‹ç›®",
      "status": "OPEN"
    },
    {
      "id": 29,
      "name": "todo29",
      "description": "29å€‹ç›®",
      "status": "OPEN"
    },
    {
      "id": 30,
      "name": "todo30",
      "description": "30å€‹ç›®",
      "status": "CLOSED"
    }
  ],
  "links": {
    "first": "http://localhost:8000/api/tasks?page=1",
    "last": "http://localhost:8000/api/tasks?page=34",
    "prev": "http://localhost:8000/api/tasks?page=9",
    "next": "http://localhost:8000/api/tasks?page=11"
  },
  "meta": {
    "current_page": 10,
    "from": 28,
    "last_page": 34,
    "links": [
      {
        "url": "http://localhost:8000/api/tasks?page=9",
        "label": "&laquo; Previous",
        "active": false
      },
      {
        "url": "http://localhost:8000/api/tasks?page=1",
        "label": "1",
        "active": false
      },
      {
        "url": "http://localhost:8000/api/tasks?page=2",
        "label": "2",
        "active": false
      },
      {
        "url": null,
        "label": "...",
        "active": false
      },
      {
        "url": "http://localhost:8000/api/tasks?page=7",
        "label": "7",
        "active": false
      },
      {
        "url": "http://localhost:8000/api/tasks?page=8",
        "label": "8",
        "active": false
      },
      {
        "url": "http://localhost:8000/api/tasks?page=9",
        "label": "9",
        "active": false
      },
      {
        "url": "http://localhost:8000/api/tasks?page=10",
        "label": "10",
        "active": true
      },
      {
        "url": "http://localhost:8000/api/tasks?page=11",
        "label": "11",
        "active": false
      },
      {
        "url": "http://localhost:8000/api/tasks?page=12",
        "label": "12",
        "active": false
      },
      {
        "url": "http://localhost:8000/api/tasks?page=13",
        "label": "13",
        "active": false
      },
      {
        "url": null,
        "label": "...",
        "active": false
      },
      {
        "url": "http://localhost:8000/api/tasks?page=33",
        "label": "33",
        "active": false
      },
      {
        "url": "http://localhost:8000/api/tasks?page=34",
        "label": "34",
        "active": false
      },
      {
        "url": "http://localhost:8000/api/tasks?page=11",
        "label": "Next &raquo;",
        "active": false
      }
    ],
    "path": "http://localhost:8000/api/tasks",
    "per_page": 3,
    "to": 30,
    "total": 100
  }
}
```

:::

Laravelã®ãƒ«ãƒ¼ã‚¿ãƒ¼ã¯ã€ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ãŸå¾Œã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®æˆ»ã‚Šå€¤ã‚’æ•´å½¢ã—ã¦ã‹ã‚‰ã‚«ãƒ¼ãƒãƒ«ã«è¿”ã—ã¾ã™ã€‚ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®æˆ»ã‚Šå€¤ã‚’æ•´å½¢ã™ã‚‹ã¨ãã¯ã€æˆ»ã‚Šå€¤ã«å¯¾ã—ã¦`toResponse`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³ã¾ã™ï¼ˆæˆ»ã‚Šå€¤ãŒ`Illuminate\Contracts\Support\Responsable`ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹å ´åˆã§ã™ã€‚APIãƒªã‚½ãƒ¼ã‚¹ã®ç¶™æ‰¿å…ƒã®JsonResourceã‚¯ãƒ©ã‚¹ã¯ã“ã‚Œã«å½“ã¦ã¯ã¾ã‚Šã¾ã™ï¼‰ã€‚

ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚¿ãƒ¼ã‚¯ãƒ©ã‚¹ã‚’æ¸¡ã—ãŸå ´åˆã®å‡¦ç†ã¯ã€ãƒªã‚½ãƒ¼ã‚¹ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®`toResponse`ãƒ¡ã‚½ãƒƒãƒ‰ã«æ›¸ã‹ã‚Œã¦ã„ã¾ã™ã€‚ã“ã¡ã‚‰ã‚’è¿½ã£ã¦ã„ãã¨ã€ä¸Šè¨˜ã®æƒ…å ±ã‚’ä»˜ä¸ã™ã‚‹å‡¦ç†ã‚’ç¢ºèªã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚

```php:ResourceCollection.php
public function toResponse($request)
{
    if ($this->resource instanceof AbstractPaginator || $this->resource instanceof AbstractCursorPaginator) {
        return $this->preparePaginatedResponse($request);
    }

    return parent::toResponse($request);
}
```

å‚è€ƒ: [Illuminate\Http\Resources\Json\ResourceCollection | Laravel API](https://laravel.com/api/9.x/Illuminate/Http/Resources/Json/ResourceCollection.html#method_toResponse)

## ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’å®Ÿè£…ã™ã‚‹

ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒšãƒ¼ã‚¸ç•ªå·ã¯ã€APIãƒªã‚½ãƒ¼ã‚¹ãŒä»˜ä¸ã—ã¦ãã‚Œã‚‹`meta.links`ã‚’ç”¨ã„ã¦ä½œæˆã—ã¦ã¿ã¾ã—ãŸã€‚

ãƒšãƒ¼ã‚¸ç•ªå·ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã¯ã€APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ã‹ã‚‰ãƒšãƒ¼ã‚¸ç•ªå·ã‚’å–å¾—ã—ã€ãƒ‡ãƒ¼ã‚¿ã®å†å–å¾—ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚

```html:frontend/pages/index.vue
<script setup>
const page = ref(1)
const { data: taskPaginator, refresh } = await useFetch(() => `/api/tasks?page=${page.value}`, {
  baseURL: 'http://localhost:8000',
})

const onClickLink = (url) => {
  page.value = new URL(url).searchParams.get('page')
  refresh()
}
</script>

<template>
  <div>
    <!-- ä¸€è¦§ã®è¡¨ç¤º -->
    <h2>ã‚¿ã‚¹ã‚¯ä¸€è¦§</h2>
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>ã‚¿ã‚¹ã‚¯å</th>
          <th>èª¬æ˜å</th>
          <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
        </tr>
      </thead>
      <tbody>
        <tr v-for="task in taskPaginator.data">
          <td>{{ task.id }}</td>
          <td>{{ task.name }}</td>
          <td>{{ task.description }}</td>
          <td>{{ task.status }}</td>
        </tr>
      </tbody>
    </table>

    <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã®è¡¨ç¤º -->
    <div class="pagination">
      <template v-for="link in taskPaginator.meta.links">
        <button
          :disabled="link.url === null"
          class="pagination-link"
          :class="{
            'pagination-link-enabled': link.url !== null,
            'pagination-link-active': link.active,
          }"
          @click="onClickLink(link.url)"
        >
          {{ link.label }}
        </button>
      </template>
    </div>
  </div>
</template>
```

![](https://i.gyazo.com/3dba8b2c9083edc5648d0054dee5ea3e.gif)

## ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåŒ–ã™ã‚‹

ä»–ã®ãƒšãƒ¼ã‚¸ã§ã‚‚ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåŒ–ã—ã¦ã¿ã¾ã™ã€‚

ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå´:

```html:frontend/components/custom/Pagination.vue
<script lang="ts" setup>
type PaginationLink = {
  url: string | null
  label: string
  active: boolean
}

type Props = {
  links: PaginationLink[]
  onClickLink: (url: string) => void
}

const { links, onClickLink } = defineProps<Props>()
</script>

<template>
  <div class="pagination">
    <template v-for="link in links">
      <button
        :disabled="link.url === null"
        class="pagination-link"
        :class="{
          'pagination-link-enabled': link.url !== null,
          'pagination-link-active': link.active,
        }"
        @click="onClickLink(link.url)"
      >
        {{ link.label }}
      </button>
    </template>
  </div>
</template>
```

å‘¼ã³å‡ºã—å´:

```html
<custom-pagination
  :links="taskPaginator.meta.links"
  :on-click-link="onClickLink"
  class="task-pagination"
/>
```

ã‚¹ãƒƒã‚­ãƒªã—ã¾ã—ãŸã€‚

## ã¾ã¨ã‚

- SPAã§ã®ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ãƒšãƒ¼ã‚¸ç•ªå·ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã¨ãã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã£ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€ç”»é¢ã‚’æ›´æ–°ã™ã‚‹
- Laravelã®APIãƒªã‚½ãƒ¼ã‚¹ã¯ã€ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã«å¿…è¦ãªãƒ¡ã‚¿æƒ…å ±ã‚’ä»˜ä¸ã—ã¦ãã‚Œã‚‹
