---
title: "Prismaã§Laravelé¢¨ã®ã‚·ãƒ¼ãƒ€ãƒ¼ã‚’ä½œã‚‹"
emoji: "ğŸŒŠ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["prisma"]
published: true
publication_name: "gibjapan"
---

ã‚·ãƒ¼ãƒ€ãƒ¼ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å‹•ã‹ã™ã®ã«å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²ã™ã‚‹ã‚‚ã®ã®ã“ã¨ã§ã™ã€‚Prismaã§ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚·ãƒ¼ãƒ€ãƒ¼ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚

- `prisma db seed`ã§ã€`package.json`ã«ç™»éŒ²ã—ãŸã‚·ãƒ¼ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã§ãã‚‹
- `prisma migrate reset`ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆã—ãŸã¨ãã€ãƒªã‚»ãƒƒãƒˆå®Œäº†å¾Œã«ã‚·ãƒ¼ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã—ã¦ãã‚Œã‚‹

ã¾ãŸã€Laravelã§ã¯ã€ã‚·ãƒ¼ãƒ€ãƒ¼ã‚’å®Ÿè¡Œã™ã‚‹ã¨ãã«ç‰¹å®šã®ã‚·ãƒ¼ãƒ€ãƒ¼ã®ã¿ã‚’å®Ÿè¡Œã™ã‚‹æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã€é–‹ç™ºä¸­ã«æ–°ãŸã«è¿½åŠ ã—ãŸãƒ†ãƒ¼ãƒ–ãƒ«ã«ãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²ã™ã‚‹ã¨ããªã©ã«å½¹ç«‹ã¡ã¾ã™ã€‚

Prisma CLIã«ã¯ã“ã®æ©Ÿèƒ½ãŒãªã‹ã£ãŸãŸã‚ã€ã“ã‚Œã‚’ã‚µãƒãƒ¼ãƒˆã—ãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ›¸ã„ã¦ã¿ã¾ã—ãŸã€‚

## ä½¿ã„æ–¹

```bash
# å…¨ã¦ã®ã‚·ãƒ¼ãƒ€ãƒ¼ã‚’å®Ÿè¡Œã™ã‚‹
prisma db seed

# ç‰¹å®šã®ã‚·ãƒ¼ãƒ€ãƒ¼ã‚’å®Ÿè¡Œã™ã‚‹
npm run db:seed postSeeder
```

## ä½œã‚Šæ–¹

Prismaã®ã‚·ãƒ¼ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€`package.json`ã®`prisma.seed`ã«ç™»éŒ²ã—ã¾ã™ã€‚ã¾ãŸã€å€‹åˆ¥ã®ã‚·ãƒ¼ãƒ€ãƒ¼ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®npm scriptã‚’æ›¸ãã¾ã™ã€‚npm scriptã‚’æ›¸ã„ãŸã®ã¯ã€`prisma db seed`ã«è¿½åŠ ã®å¼•æ•°ã‚’æ¸¡ã™ã“ã¨ãŒã§ããªã‹ã£ãŸã‹ã‚‰ã§ã™ã€‚

```json:package.json
{
  "scripts": {
    "db:seed": "ts-node --transpileOnly src/database/seeder/index.ts"
  },
  "prisma": {
    "seed": "ts-node --transpileOnly src/database/seeder/index.ts"
  }
}
```

ã‚·ãƒ¼ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ä»¥ä¸‹ã§ã™ã€‚å¼•æ•°ã‚’æŒ‡å®šã—ãªã‹ã£ãŸå ´åˆã¯å…¨ã¦ã®ã‚·ãƒ¼ãƒ€ãƒ¼ã‚’å®Ÿè¡Œã—ã€ã‚·ãƒ¼ãƒ€ãƒ¼åã‚’æŒ‡å®šã™ã‚‹ã¨ç‰¹å®šã®ã‚·ãƒ¼ãƒ€ãƒ¼ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```ts:src/database/seeder/index.ts
import { PrismaClient } from '@prisma/client'
import { userSeeder } from './user-seeder'
import { postSeeder } from './post-seeder'
import { prisma } from "../prisma"

const databaseSeeder = {
  userSeeder,
  postSeeder,
}

type SeederName = keyof typeof databaseSeeder

async function main() {
  const seederName = process.argv[2]
  if (seederName === undefined) {
    for (const [name, seeder] of Object.entries(databaseSeeder)) {
      console.log(`Seeding: ${name}`)
      await seeder()
    }
    return
  }

  if (seederName in databaseSeeder) {
    const seeder = databaseSeeder[seederName as SeederName]
    console.log(`Seeding: ${seederName}`)
    await seeder()
    return
  }

  console.error('Error: ã‚·ãƒ¼ãƒ€ãƒ¼åãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“')
  process.exit(1)
}

main()
  .then(async () => {
    await prisma.$disconnect()
  })
  .catch(async (e) => {
    console.error(e)
    await prisma.$disconnect()
    process.exit(1)
  })
```

å€‹åˆ¥ã®ã‚·ãƒ¼ãƒ€ãƒ¼ã¯å˜ãªã‚‹éåŒæœŸé–¢æ•°ã§ã™ã€‚

```ts:src/database/seeder/user-seeder.ts
import { prisma } from "../prisma"

async function userSeeder() {
  // ãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²ã™ã‚‹å‡¦ç†
}
```

## å‚è€ƒ

- [Seeding your database](https://www.prisma.io/docs/guides/database/seed-database)
