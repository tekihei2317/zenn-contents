---
title: "Stoplight Studioã¨OpenAPI Generatorã‚’ä½¿ã£ã¦ã¿ã‚‹"
emoji: "ğŸ’¨"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["openapi", "openapigenerator", "vue"]
published: true
---

Nuxtï¼ˆSPAï¼‰ã¨Laravelã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã€[Stoplight Studio](https://stoplight.io/studio)ã¨OpenAPI Generatorã‚’å°å…¥ã—ã¦ã¿ã¾ã—ãŸã€‚ã‚¹ã‚­ãƒ¼ãƒã‚’å®šç¾©ã—ã¦ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®å‹ã‚’ç”Ÿæˆã™ã‚‹ã¾ã§ã®ãƒ¡ãƒ¢ã‚’æ›¸ããŸã„ã¨æ€ã„ã¾ã™ã€‚

https://github.com/tekihei2317/stoplight-and-typescript-frontend

## ç’°å¢ƒ

- @openapitools/openapi-generator-cli@2.5.1

## Stoplight Studioã¨ã¯

[Stoplight Studio](https://stoplight.io/studio)ã¯ã€OpenAPIã®å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚’GUIã§ä½œæˆã§ãã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚å®šç¾©ã—ãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«Postmanã®ã‚ˆã†ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã£ãŸã‚Šã€ãƒ€ãƒŸãƒ¼ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒãƒ¼ãŒçµ„ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã™ã€‚

## APIã®å®šç¾©

ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã€ä½œæˆã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’Stoplight Studioã‚’èµ·å‹•ã—ãŸå¾Œé–‹ãã¾ã™ã€‚ãƒ¢ãƒãƒ¬ãƒãªã®ã§ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«`apispec`ã¨ã„ã†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œã‚Šã¾ã—ãŸã€‚

1ç‚¹æ³¨æ„ãŒå¿…è¦ãªã®ã¯ã€openapi-generatorãŒOAS3.1ã«ã¾ã å¯¾å¿œã—ã¦ã„ãªã„ã“ã¨ã§ã™ã€‚ãã®ãŸã‚ã€Stoplight Studioã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’é¸æŠã™ã‚‹ã¨ãã¯ã€3.0ã‚’é¸æŠã—ã¾ã™ã€‚

![https://i.gyazo.com/7d559cefa0c3e737da271ee622d35b4a.png](https://i.gyazo.com/7d559cefa0c3e737da271ee622d35b4a.png)

openapi-generatorãŒä½¿ç”¨ã—ã¦ã„ã‚‹swagger-parserãŒæœ€è¿‘OAS3.1ã«å¯¾å¿œã—ãŸã¿ãŸã„ãªã®ã§ã€ã“ã‚Œã‹ã‚‰3.1å¯¾å¿œãŒé€²ã¿ãã†ãªæ°—é…ãŒã‚ã‚Šã¾ã™ã€‚

https://github.com/OpenAPITools/openapi-generator/issues/9083

Stoplight Studioã§ã¯ã€ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å®šç¾©ã—ã¾ã™ã€‚ã“ã®ã‚ãŸã‚Šã¯GUIã‚’ãƒãƒãƒãƒã™ã‚‹ã ã‘ã§ã—ãŸã€‚ä»Šå›ã¯ã‚¿ã‚¹ã‚¯ã®è©³ç´°ã¨ç·¨é›†ã®APIã‚¹ã‚­ãƒ¼ãƒã‚’å®šç¾©ã—ã¦ã¿ã¾ã—ãŸã€‚

:::details ã‚¹ã‚­ãƒ¼ãƒå®šç¾©

```yaml:apispec/references/todo-app.yml
openapi: 3.0.0
x-stoplight:
  id: dmiy7jxs5yhc4
info:
  title: todo-app
  version: "1.0"
servers:
  - url: "http://localhost:3100"
paths:
  "/tasks/{taskId}":
    parameters:
      - schema:
          type: string
        name: taskId
        in: path
        required: true
    get:
      summary: ã‚¿ã‚¹ã‚¯è©³ç´°ã‚’å–å¾—ã™ã‚‹
      tags:
        - tasks
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  name:
                    type: string
                  description:
                    type: string
                    nullable: true
                  status:
                    type: string
                  status_id:
                    type: integer
                    minimum: 1
                    maximum: 5
                required:
                  - id
                  - name
                  - description
                  - status
                  - status_id
      operationId: get-tasks-taskId
    put:
      summary: ã‚¿ã‚¹ã‚¯ã‚’æ›´æ–°ã™ã‚‹
      tags:
        - tasks
      responses:
        "204":
          description: No Content
      operationId: put-tasks-taskId
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                description:
                  type: string
                status_id:
                  type: number
              required:
                - name
                - status_id
components:
  schemas: {}
```
:::

## å‹ã®è‡ªå‹•ç”Ÿæˆ

openapi-generatorã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚yarnã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ãŸã€‚

```bash
yarn add -D @openapitools/openapi-generator-cli
```

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã€APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨å‹å®šç¾©ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

```bash
openapi-generator-cli generate -i ../apispec/reference/todo-app.yaml -g typescript-fetch -o api -c ./openapi-generator.json
```

å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯APIå®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ï¼ˆ`-i`ï¼‰ã¨ã€ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆ`-g`ï¼‰ã§ã™ã€‚å‹ã ã‘ã‚’ä½¿ç”¨ã—ãŸã‹ã£ãŸã®ã§ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ã‚·ãƒ³ãƒ—ãƒ«ãã†ãªtypescript-fetchã‚’é¸æŠã—ã¾ã—ãŸã€‚ãã®ä»–ã€å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å | èª¬æ˜                         |
| ------------ | ---------------------------- |
| -i           | APIå®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹        |
| -g           | ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ |
| -o           | å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª             |
| -c           | è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹           |


è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã‚’ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ã«ã™ã‚‹è¨­å®šã‚’æ›¸ãã¾ã—ãŸã€‚

```json:openapi-generator.json
{
  "modelPropertyNaming": "snake_case"
}
```

ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œã‚‰ã‚Œã¾ã™ã€‚

```tsx
api
â”œâ”€â”€ apis
â”‚Â Â  â”œâ”€â”€ TasksApi.ts
â”‚Â Â  â””â”€â”€ index.ts
â”œâ”€â”€ index.ts
â”œâ”€â”€ models
â”‚Â Â  â”œâ”€â”€ GetTasksTaskId200Response.ts
â”‚Â Â  â”œâ”€â”€ PutTasksTaskIdRequest.ts
â”‚Â Â  â””â”€â”€ index.ts
â””â”€â”€ runtime.ts
```

apisã®ä¸­èº«ãŒAPIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ã€modelsã®ä¸­ã«å®šç¾©ã—ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚„ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å‹ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚modelã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªå‹å®šç¾©ãŒæ›¸ã‹ã‚Œã¦ã„ã¾ã™ã€‚

```ts
// ã‚¿ã‚¹ã‚¯è©³ç´°APIã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ã®å‹
export interface GetTasksTaskId200Response {
  id: number;
  name: string;
  description: string | null;
  status: string;
  status_id: number;
}

// ã‚¿ã‚¹ã‚¯ç·¨é›†APIã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã®å‹
export interface PutTasksTaskIdRequest {
    name: string;
    description?: string;
    status_id: number;
}
```

## ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹ã‚‰ãƒ•ã‚©ãƒ¼ãƒ ã®å‹ã«å¤‰æ›ã™ã‚‹

ç”Ÿæˆã•ã‚ŒãŸå‹ã‚’ã€ãƒ•ã‚©ãƒ¼ãƒ ã«åˆã‚ã›ãŸå‹ã«å¤‰æ›ã™ã‚‹å‹ã‚’ã¤ãã‚Šã¾ã™ã€‚ãƒ•ã‚©ãƒ¼ãƒ ã®åˆæœŸå€¤ã¯nullã«ã—ãŸã‹ã£ãŸã®ã§ã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«nullå‹ã‚’åŠ ãˆã¦ã„ã¾ã™ã€‚

```ts
// TODO: objectä»¥å¤–ã®ã„ã„æ„Ÿã˜ã®å‹ã‚’ä½¿ã†
export type RequestToForm<T extends object> = {
  [K in keyof T]-?: T[K] extends object ? RequestToForm<T[K]> : T[K] | null
}
```

`-?`ã§çœç•¥å¯èƒ½ã‚’å¤–ã—ã¦ã„ã‚‹ã®ã¯ã€ï¼ˆä½œã£ã¦ã„ã‚‹ã®ãŒæ¥­å‹™ã‚·ã‚¹ãƒ†ãƒ ãªã®ã‚‚ã‚ã‚Šï¼‰çœç•¥å¯èƒ½ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒãŸãã•ã‚“ã‚ã£ãŸãŸã‚ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ä»£å…¥ã—å¿˜ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã§ã™ã€‚

```ts
form.value = dataFromApi // refã«ã¾ã‚‹ã£ã¨ä»£å…¥ã™ã‚‹ã¨ãã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒçœç•¥å¯èƒ½ã ã¨æ¸¡ã—å¿˜ã‚Œã«æ°—ã¥ã‘ãªã„
```

ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ä½¿ã„ã¾ã™ã€‚

```ts
// ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆéƒ¨åˆ†ã¯çœç•¥
import axios from "axios";
import { reactive } from "vue";
import { GetTasksTaskId200Response, PutTasksTaskIdRequest } from "./api";
import { RequestToForm } from "./utils/form";

const taskId = 1;
const endpoint = `http://localhost:3100/tasks/${taskId}`;

// ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã®å‹ã‹ã‚‰ã€ãƒ•ã‚©ãƒ¼ãƒ ã®å‹ã‚’ä½œæˆã™ã‚‹
type EditTaskForm = RequestToForm<PutTasksTaskIdRequest>;

// ãƒ•ã‚©ãƒ¼ãƒ ã‚’åˆæœŸåŒ–ã™ã‚‹
const editForm = reactive<EditTaskForm>({
  name: null,
  description: null,
  status_id: null,
});

// APIã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹
axios.get<GetTasksTaskId200Response>(endpoint).then((response) => {
  editForm.name = response.data.name;
  editForm.description = response.data.description;
  editForm.status_id = response.data.status_id;
});

// ãƒ•ã‚©ãƒ¼ãƒ ã‚’é€ä¿¡ã™ã‚‹
const onSubmit = () => {
  axios.put(endpoint, editForm).then(() => {
    alert("ã‚¿ã‚¹ã‚¯ã‚’æ›´æ–°ã—ã¾ã—ãŸ");
  });
};

// ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆéƒ¨åˆ†ã¯çœç•¥
```

## ã¾ã¨ã‚

- OpenAPI GeneratorãŒOAS3.1ã«æœªå¯¾å¿œã®ãŸã‚ã€Stoplight Studioã§ã¯3.0ã‚’ä½¿ç”¨ã™ã‚‹
- openapi-generatorã‚’ä½¿ã†ã¨ã€å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰TypeScriptã®å‹å®šç¾©ã‚’è‡ªå‹•ç”Ÿæˆã§ãã‚‹
- è‡ªå‹•ç”Ÿæˆã—ãŸAPIã®å‹ã‚’ãƒ•ã‚©ãƒ¼ãƒ ç”¨ã«å¤‰æ›ã™ã‚‹å‹ã‚’æ›¸ã‘ã°ã„ã„ã‹ã‚‚ã—ã‚Œãªã„

ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒãƒ¼ã‚’ä½¿ç”¨ã—ãŸãƒ†ã‚¹ãƒˆã‚„ã€APIå®šç¾©ã¨APIã‚’ä¸€è‡´ã•ã›ã‚‹ãŸã‚ã®ä»•çµ„ã¿ã¯ã¾ã ã§ãã¦ã„ãªã„ã®ã§ã€ä»Šå¾Œå®Ÿè·µã—ã¦ã„ã‘ã‚Œã°ã¨æ€ã„ã¾ã™ã€‚~~GraphQLãŒã†ã‚‰ã‚„ã¾ã—ã„~~

## å‚è€ƒ

- [openapi-generator-cli ã«ã‚ˆã‚‹ TypeScript å‹å®šç¾©](https://zenn.dev/takepepe/articles/openapi-generator-cli-ts#axios-fetcher-%E3%82%92%E4%BD%BF%E3%81%84%E3%81%9F%E3%81%8F%E3%81%AA%E3%81%84%E5%A0%B4%E5%90%88)
- [TypeScript ã®å‹ç”Ÿæˆã«ãŠã‘ã‚‹ OpenAPI Generator ã®ãƒãƒã‚Šã©ã“ã‚ - READYFOR Tech Blog](https://tech.readyfor.jp/entry/2021/04/15/170227)
- https://github.com/OpenAPITools/openapi-generator/issues/9083
